// ==============================================
// PRISMA SCHEMA - ClassCheck
// Database: PostgreSQL 16
// ==============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==============================================
// MODELOS DO CLASSCHECK
// ==============================================

// Modelo Usuario
model Usuario {
  id        Int      @id @default(autoincrement())
  email     String   @unique @db.VarChar(255)
  nome      String   @db.VarChar(255)
  avatar    String?  @db.Text
  role      Role     @default(ALUNO)
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  avaliacoes     Avaliacao[]
  humorRegistros HumorRegistro[]
  aulasFavoritas AulaFavorita[]

  @@index([email])
  @@index([role])
  @@index([ativo])
  @@map("usuarios")
}

// Modelo Professor  
model Professor {
  id        Int      @id @default(autoincrement())
  nome      String   @db.VarChar(255)
  email     String   @unique @db.VarChar(255)
  materia   String   @db.VarChar(255)
  avatar    String?  @db.Text
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  aulas Aula[]

  @@index([email])
  @@index([materia])
  @@index([ativo])
  @@map("professores")
}

// Modelo Aula
model Aula {
  id          Int      @id @default(autoincrement())
  titulo      String   @db.VarChar(255)
  descricao   String?  @db.Text
  materia     String   @db.VarChar(255)
  dataHora    DateTime
  duracao     Int      // em minutos
  professorId Int
  sala        String?  @db.VarChar(100)
  status      StatusAula @default(AGENDADA)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  professor      Professor      @relation(fields: [professorId], references: [id])
  avaliacoes     Avaliacao[]
  aulasFavoritas AulaFavorita[]
  eventos        Evento[]

  @@index([professorId])
  @@index([dataHora])
  @@index([materia])
  @@index([status])
  @@map("aulas")
}

// Modelo Avaliacao (Humor/Feedback da aula)
model Avaliacao {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  humor     TipoHumor
  nota      Int?     @db.SmallInt // 1-5 estrelas
  feedback  String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])

  // Um usu치rio s칩 pode avaliar uma aula uma vez
  @@unique([usuarioId, aulaId])
  @@index([usuarioId])
  @@index([aulaId])
  @@index([createdAt])
  @@index([humor])
  @@map("avaliacoes")
}

// Modelo HumorRegistro (Registro di치rio de humor)
model HumorRegistro {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  humor     TipoHumor
  data      DateTime @default(now()) @db.Date
  observacao String? @db.Text
  createdAt DateTime @default(now())

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])

  // Um usu치rio s칩 pode registrar humor uma vez por dia
  @@unique([usuarioId, data])
  @@index([usuarioId])
  @@index([data])
  @@index([humor])
  @@map("humor_registros")
}

// Modelo AulaFavorita
model AulaFavorita {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  createdAt DateTime @default(now())

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])

  // Um usu치rio n칚o pode favoritar a mesma aula duas vezes
  @@unique([usuarioId, aulaId])
  @@index([usuarioId])
  @@index([aulaId])
  @@index([createdAt])
  @@map("aulas_favoritas")
}

// Modelo Evento (Calend치rio)
model Evento {
  id        Int         @id @default(autoincrement())
  titulo    String      @db.VarChar(255)
  descricao String?     @db.Text
  dataInicio DateTime
  dataFim   DateTime?
  cor       String?     @db.VarChar(7) // Hex color
  tipo      TipoEvento  @default(EVENTO)
  aulaId    Int?        // Opcional, pode ser evento n칚o relacionado a aula
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relacionamentos
  aula Aula? @relation(fields: [aulaId], references: [id])

  @@index([dataInicio])
  @@index([tipo])
  @@index([aulaId])
  @@map("eventos")
}

// ==============================================
// ENUMS
// ==============================================

enum Role {
  ALUNO
  PROFESSOR
  ADMIN
}

enum TipoHumor {
  MUITO_TRISTE  // 游땩 1
  TRISTE        // 游땟 2  
  NEUTRO        // 游땛 3
  FELIZ         // 游뗵 4
  MUITO_FELIZ   // 游땏 5
}

enum StatusAula {
  AGENDADA
  EM_ANDAMENTO
  CONCLUIDA  
  CANCELADA
}

enum TipoEvento {
  AULA
  PROVA
  EVENTO
  FERIADO
  REUNIAO
}

// ==============================================
// PRISMA SCHEMA - ClassCheck
// ==============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==============================================
// MODELOS DO CLASSCHECK
// ==============================================

// Modelo Usuario
model Usuario {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  nome      String
  avatar    String?
  role      Role     @default(ALUNO)
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  avaliacoes                Avaliacao[]
  avaliacoesSocioemocionais AvaliacaoSocioemocional[]
  avaliacoesDidaticas       AvaliacaoDidatica[]
  avaliacoesProfessores     AvaliacaoProfessor[]
  humorRegistros            HumorRegistro[]
  aulasFavoritas            AulaFavorita[]

  @@map("usuarios")
}

// Modelo Professor  
model Professor {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  materia   String
  avatar    String?
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  aulas                 Aula[]
  avaliacoesProfessores AvaliacaoProfessor[]

  @@map("professores")
}

// Modelo Aula
model Aula {
  id          Int      @id @default(autoincrement())
  titulo      String
  descricao   String?
  materia     String
  dataHora    DateTime
  duracao     Int      // em minutos
  professorId Int
  sala        String?
  status      StatusAula @default(AGENDADA)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  professor                 Professor                 @relation(fields: [professorId], references: [id])
  avaliacoes                Avaliacao[]
  avaliacoesSocioemocionais AvaliacaoSocioemocional[]
  avaliacoesDidaticas       AvaliacaoDidatica[]
  aulasFavoritas            AulaFavorita[]
  eventos                   Evento[]

  @@map("aulas")
}

// Modelo Avaliacao (Humor/Feedback da aula)
model Avaliacao {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  humor     TipoHumor
  nota      Int? // 1-5 estrelas
  feedback  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])

  // Um usu√°rio s√≥ pode avaliar uma aula uma vez
  @@unique([usuarioId, aulaId])
  @@map("avaliacoes")
}

// ==============================================
// NOVOS MODELOS - SISTEMA DE AVALIA√á√ÉO REESTRUTURADO
// ==============================================

// Modelo AvaliacaoSocioemocional (Question√°rio Adaptativo - Circumplex)
model AvaliacaoSocioemocional {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  
  // Dados do Modelo Circumplex
  valencia  Float    // -1.0 (negativo) a 1.0 (positivo)
  ativacao  Float    // -1.0 (baixa energia) a 1.0 (alta energia)
  estadoPrimario String // "Animado", "Calmo", "Entediado", "Ansioso", etc.
  confianca Float    // 0.0 a 1.0 (confian√ßa da medi√ß√£o IRT)
  
  // Metadados do question√°rio adaptativo
  totalPerguntas Int  // 5-12 perguntas
  tempoResposta  Int  // em segundos
  respostas      String // JSON: [{perguntaId, valor, timestamp}]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])
  
  // Um usu√°rio s√≥ pode fazer avalia√ß√£o socioemocional uma vez por aula
  @@unique([usuarioId, aulaId])
  @@map("avaliacoes_socioemocionais")
}

// Modelo AvaliacaoDidatica (Avalia√ß√£o do Conte√∫do/Pedagogia)
model AvaliacaoDidatica {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  
  // Crit√©rios did√°ticos (escala 1-5)
  compreensaoConteudo Int  // O quanto entendeu o conte√∫do
  ritmoAula          Int   // Velocidade adequada (1=muito lento, 5=muito r√°pido, 3=ideal)
  recursosDidaticos  Int   // Qualidade dos slides, exemplos, materiais
  engajamento        Int   // N√≠vel de envolvimento com a aula
  
  // Feedback estruturado (opcional)
  pontoPositivo    String?  // O que funcionou bem
  pontoMelhoria    String?  // O que pode melhorar
  sugestao         String?  // Sugest√µes espec√≠ficas
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])
  
  // Um usu√°rio s√≥ pode fazer avalia√ß√£o did√°tica uma vez por aula
  @@unique([usuarioId, aulaId])
  @@map("avaliacoes_didaticas")
}

// Modelo AvaliacaoProfessor (Avalia√ß√£o Peri√≥dica/Coletiva do Professor)
model AvaliacaoProfessor {
  id          Int      @id @default(autoincrement())
  usuarioId   Int
  professorId Int
  periodo     String   // "2025-10" (ano-m√™s) - limita 1 avalia√ß√£o por m√™s
  
  // Crit√©rios de avalia√ß√£o do professor (escala 1-5)
  dominioConteudo    Int  // Conhecimento da mat√©ria
  clarezaExplicacao  Int  // Did√°tica e clareza
  pontualidade       Int  // Pontualidade e assiduidade
  organizacao        Int  // Organiza√ß√£o das aulas
  acessibilidade     Int  // Disponibilidade para d√∫vidas
  empatia            Int  // Empatia com alunos
  
  // Coment√°rio an√¥nimo (opcional)
  comentario String?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relacionamentos
  usuario   Usuario   @relation(fields: [usuarioId], references: [id])
  professor Professor @relation(fields: [professorId], references: [id])
  
  // Um usu√°rio s√≥ pode avaliar um professor uma vez por per√≠odo
  @@unique([usuarioId, professorId, periodo])
  @@map("avaliacoes_professores")
}

// Modelo HumorRegistro (Registro di√°rio de humor)
model HumorRegistro {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  humor     TipoHumor
  data      DateTime @default(now())
  observacao String?
  createdAt DateTime @default(now())

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])

  // Um usu√°rio s√≥ pode registrar humor uma vez por dia
  @@unique([usuarioId, data])
  @@map("humor_registros")
}

// Modelo AulaFavorita
model AulaFavorita {
  id        Int      @id @default(autoincrement())
  usuarioId Int
  aulaId    Int
  createdAt DateTime @default(now())

  // Relacionamentos
  usuario Usuario @relation(fields: [usuarioId], references: [id])
  aula    Aula    @relation(fields: [aulaId], references: [id])

  // Um usu√°rio n√£o pode favoritar a mesma aula duas vezes
  @@unique([usuarioId, aulaId])
  @@map("aulas_favoritas")
}

// Modelo Evento (Calend√°rio)
model Evento {
  id        Int         @id @default(autoincrement())
  titulo    String
  descricao String?
  dataInicio DateTime
  dataFim   DateTime?
  cor       String? // Hex color
  tipo      TipoEvento  @default(EVENTO)
  aulaId    Int?        // Opcional, pode ser evento n√£o relacionado a aula
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relacionamentos
  aula Aula? @relation(fields: [aulaId], references: [id])

  @@map("eventos")
}

// ==============================================
// ENUMS
// ==============================================

enum Role {
  ALUNO
  PROFESSOR
  ADMIN
}

enum TipoHumor {
  MUITO_TRISTE  // üò¢ 1
  TRISTE        // üòï 2  
  NEUTRO        // üòê 3
  FELIZ         // üôÇ 4
  MUITO_FELIZ   // üòÑ 5
}

enum StatusAula {
  AGENDADA
  EM_ANDAMENTO
  CONCLUIDA  
  CANCELADA
}

enum TipoEvento {
  AULA
  PROVA
  EVENTO
  FERIADO
  REUNIAO
}
